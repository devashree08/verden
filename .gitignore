flowchart LR
  subgraph Dev[".env + procs.registry.json"]
    REG[Registry\n(endpoints, params, modelName)]
    ENV[.env\n(DB creds, API key)]
  end

  subgraph API["FastAPI service"]
    MAIN[main.py\n(routes + auth + OpenAPI)]
    CONTRACT[contract.py\n(param & response schemas)]
    DBAPI[db.py\n(ODBC pool + exec_proc + describe columns)]
  end

  subgraph MCP["MCP Server (stdio)"]
    MCPS[ mcp_server.py\n(list_tools / call_tool) ]
  end

  SWG[Swagger UI\n(/docs)]
  C42[42Crunch\n(API audit)]
  AGENT[AI Agent / IDE\n(MCP client)]
  APP[Callers of REST API]

  SQL[(SQL Server)]

  REG --load--> MAIN
  ENV --load--> MAIN
  ENV --load--> MCPS

  MAIN --calls--> CONTRACT
  CONTRACT --uses--> DBAPI
  DBAPI <--ODBC--> SQL

  MCPS --uses--> CONTRACT
  MCPS --uses--> DBAPI

  APP --HTTP/JSON--> MAIN
  SWG --- MAIN
  C42 --- MAIN

  AGENT --MCP--> MCPS
